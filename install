#!/usr/bin/env zsh

home_files=(".aliases" ".bash_profile" ".bashrc" ".editorconfig" ".exports" ".functions" ".gitconfig" ".inputrc" ".profile" ".tmux.conf" ".zprofile" ".zshenv" ".zshrc")
home_directories=(".ssh")
config_files=("starship.toml")
config_directories=("fish" "ghostty" "lazygit" "nvim" "pypoetry" "wezterm" "zed" "zellij")

# make sure directories exist
if [ ! -d "$HOME/.config" ]; then
    mkdir "$HOME/.config"
fi

# create symlinks
repo="$( cd "$( dirname "$0" )" && pwd )"

symlink_fn() {
	local file_or_folder=$1
	local target_dir=$2

	local source="$repo/$file_or_folder"
	local target="$target_dir/$file_or_folder"

	local source_does_not_exist=0

	if [ ! -f $source ]; then
		if [ ! -d $source ]; then
			source_does_not_exist=1
		fi
	fi
	if [[ $source_does_not_exist = 1 ]]; then
		echo "'$source': file does not exist (ERROR)"
	else
		if [ -f $target ]; then
			if [ -L $target ]; then
				echo "'$target' already exists (symlink ok)"
			else
				echo "'$target' already exists (CONFLICT)"
			fi
		elif [ -d "$target" ]; then
			if [ -L $target ]; then
				echo "'$target' already exists (symlink ok)"
			else
				echo "'$target' already exists (CONFLICT)"
			fi
		else
			if command -v gln > /dev/null; then
				gln -svT $source $target
			else
				ln -sv $source $target
			fi
		fi
	fi
}

for file ("$home_files[@]"); do
	symlink_fn $file $HOME
done

for folder ("$home_directories[@]"); do
	symlink_fn $folder $HOME
done

for file ("$config_files[@]"); do
	symlink_fn $file $HOME/.config
done

for folder ("$config_directories[@]"); do
	symlink_fn $folder $HOME/.config
done


exit 0
